import*as e from"@wordpress/interactivity";var t={d:(e,s)=>{for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const s=(a={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store},o={},t.d(o,a),o);var a,o;async function c(e){try{const t=e.map((async e=>{const t=await fetch(`https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${e}&strategy=mobile&category=accessibility&category=best-practices&category=performance&category=seo&key=AIzaSyBEQiaTL4wMnMCQA2WABjuIAOXLaL5LUo0`).then((e=>e.json()));return{url:e,performance:100*t?.lighthouseResult?.categories?.performance?.score,accessibility:100*t?.lighthouseResult?.categories?.accessibility?.score,best_practices:100*t?.lighthouseResult?.categories?.["best-practices"]?.score,seo:100*t?.lighthouseResult?.categories?.seo?.score}}));return await Promise.all(t)}catch(e){console.log(e)}}async function r(e,t){try{console.log(`${e}wp-json/wp/v2/pages${t}`);const s=await fetch(`${e}wp-json/wp/v2/pages${t}`);if(!s.ok)throw new Error("Failed to fetch data");const a=(await s.json()).map((e=>e?.link));return{totalPages:s?.headers.get("x-wp-totalpages"),urls:a}}catch(e){console.error(e)}}const{state:n,callbacks:l}=(0,s.store)("pagespeed-app",{actions:{submit:async()=>{const e=(0,s.getContext)();if(l.isUrlValid()){e.processing=!0,e.submitBtnText="Processing...";let t=1,s=!1;try{for(;!s;){console.log(s,t);const a=`?page=${t}`,o=await r(e.url,a),n=o?.totalPages;e.submitBtnText=`Processing... Page ${t} out of ${n}`;const l=await c(o?.urls);e.pagespeedResults=[...e.pagespeedResults,...l],console.log(e.pagespeedResults),t<parseInt(n)?t+=1:s=!0}}catch(e){console.log(e)}finally{e.processing=!1,e.submitBtnText="Submit"}}}},callbacks:{setUrl:()=>{const e=(0,s.getContext)(),{ref:t}=(0,s.getElement)();e.url=t.value},setOptions:()=>{const e=(0,s.getContext)(),{post_types:t,category:a}=e,{ref:o}=(0,s.getElement)();switch(o.name){case"device":e.device=o.value;break;case"post_types":t.includes(o.value)?e.post_types.splice(t.indexOf(o.value),1):e.post_types.push(o.value);break;case"category":a.includes(o.value)?e.category.splice(a.indexOf(o.value),1):e.category.push(o.value)}},isUrlValid:()=>{try{const e=(0,s.getContext)();return new RegExp("^([a-zA-Z]+:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e.url)}catch(e){return!1}}}});