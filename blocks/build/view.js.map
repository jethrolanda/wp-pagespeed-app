{"version":3,"file":"view.js","mappings":"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","sources":["webpack://blocks/./src/actions.js","webpack://blocks/external module \"@wordpress/interactivity\"","webpack://blocks/webpack/bootstrap","webpack://blocks/webpack/runtime/define property getters","webpack://blocks/webpack/runtime/hasOwnProperty shorthand","webpack://blocks/webpack/runtime/make namespace object","webpack://blocks/./src/view.js"],"sourcesContent":["export async function pageSpeed(urls) {\r\n  try {\r\n    const promises = urls.map(async (url) => {\r\n      const report = await fetch(\r\n        `https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${url}&strategy=mobile&category=accessibility&category=best-practices&category=performance&category=seo&key=AIzaSyBEQiaTL4wMnMCQA2WABjuIAOXLaL5LUo0`\r\n      ).then((response) => {\r\n        return response.json();\r\n      });\r\n\r\n      return {\r\n        url,\r\n        performance:\r\n          report?.lighthouseResult?.categories?.performance?.score * 100,\r\n        accessibility:\r\n          report?.lighthouseResult?.categories?.accessibility?.score * 100,\r\n        best_practices:\r\n          report?.lighthouseResult?.categories?.[\"best-practices\"]?.score * 100,\r\n        seo: report?.lighthouseResult?.categories?.seo?.score * 100\r\n      };\r\n    });\r\n\r\n    return await Promise.all(promises);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n}\r\n\r\nexport async function getPages(url, params) {\r\n  try {\r\n    console.log(`${url}wp-json/wp/v2/pages${params}`);\r\n    const response = await fetch(`${url}wp-json/wp/v2/pages${params}`);\r\n    if (!response.ok) {\r\n      throw new Error(\"Failed to fetch data\");\r\n    }\r\n\r\n    const data = await response.json();\r\n    const urls = data.map((page) => page?.link); // eslint-disable-line no-use-before-define\r\n\r\n    return {\r\n      totalPages: response?.headers.get(\"x-wp-totalpages\"),\r\n      urls\r\n    };\r\n\r\n    // return { response, urls };\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n}\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress dependencies\n */\nimport { store, getContext, getElement } from \"@wordpress/interactivity\";\nimport { getPages, pageSpeed } from \"./actions\";\nconst { state, callbacks } = store(\"pagespeed-app\", {\n  actions: {\n    submit: async () => {\n      const context = getContext();\n\n      if (callbacks.isUrlValid()) {\n        context.processing = true;\n        context.submitBtnText = \"Processing...\";\n        //   const formData = new FormData();\n        //   formData.append(\"action\", \"wpa_generate_pagespeed_report\");\n        //   formData.append(\"nonce\", state.nonce);\n        //   formData.append(\"url\", context.url);\n        //   formData.append(\"device\", context.device);\n        //   formData.append(\"post_types\", context.post_types);\n        //   formData.append(\"category\", context.category);\n\n        //   yield fetch(state.ajax_url, {\n        //     method: \"POST\",\n        //     body: formData\n        //   })\n        //     .then((response) => response.json())\n        //     .then((data) => {\n        //       console.log(data);\n        //       if (data.status === \"success\") {\n        //       }\n        //     })\n        //     .finally(() => {\n        //       context.processing = false;\n        //       context.submitBtnText = \"Submit\";\n        //     });\n        // } else {\n        //   alert(\"Invalid url\");\n        let page = 1;\n        let isDone = false;\n\n        try {\n          while (!isDone) {\n            console.log(isDone, page);\n            const query = `?page=${page}`;\n            const result = await getPages(context.url, query);\n            const totalPages = result?.totalPages;\n            context.submitBtnText = `Processing... Page ${page} out of ${totalPages}`;\n            const scores = await pageSpeed(result?.urls);\n            context.pagespeedResults = [...context.pagespeedResults, ...scores];\n            // setData((prev) => [...prev, ...scores]);\n\n            console.log(context.pagespeedResults);\n            if (page < parseInt(totalPages)) {\n              page += 1;\n            } else {\n              isDone = true;\n            }\n          }\n        } catch (error) {\n          console.log(error);\n        } finally {\n          context.processing = false;\n          context.submitBtnText = \"Submit\";\n        }\n      }\n    }\n  },\n  callbacks: {\n    setUrl: () => {\n      const context = getContext();\n      const { ref } = getElement();\n      context.url = ref.value;\n    },\n    setOptions: () => {\n      const context = getContext();\n      const { post_types, category } = context;\n      const { ref } = getElement();\n\n      switch (ref.name) {\n        case \"device\":\n          context.device = ref.value;\n          break;\n        case \"post_types\":\n          if (!post_types.includes(ref.value)) {\n            context.post_types.push(ref.value);\n          } else {\n            context.post_types.splice(post_types.indexOf(ref.value), 1);\n          }\n          break;\n        case \"category\":\n          if (!category.includes(ref.value)) {\n            context.category.push(ref.value);\n          } else {\n            context.category.splice(category.indexOf(ref.value), 1);\n          }\n          break;\n        default:\n          break;\n      }\n    },\n    isUrlValid: () => {\n      try {\n        const context = getContext();\n        const pattern = new RegExp(\n          \"^([a-zA-Z]+:\\\\/\\\\/)?\" + // protocol\n            \"((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|\" + // domain name\n            \"((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))\" + // OR IP (v4) address\n            \"(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*\" + // port and path\n            \"(\\\\?[;&a-z\\\\d%_.~+=-]*)?\" + // query string\n            \"(\\\\#[-a-z\\\\d_]*)?$\", // fragment locator\n          \"i\"\n        );\n\n        // console.log(new URL(context.url));\n        // return new URL(context.url) ? true : false;\n        return pattern.test(context.url);\n      } catch (error) {\n        return false;\n      }\n    }\n  }\n});\n"],"names":["pageSpeed","urls","promises","map","url","report","fetch","then","response","json","performance","lighthouseResult","categories","score","accessibility","best_practices","seo","Promise","all","error","console","log","getPages","params","ok","Error","data","page","link","totalPages","headers","get","store","getContext","getElement","state","callbacks","actions","submit","context","isUrlValid","processing","submitBtnText","isDone","query","result","scores","pagespeedResults","parseInt","setUrl","ref","value","setOptions","post_types","category","name","device","includes","push","splice","indexOf","pattern","RegExp","test"],"sourceRoot":""}